include:
  - project: 'redmic-project/gitlab-ci-templates'
    ref: master
    file: '/maven-building-functional-unit.yml'
  - project: 'redmic-project/gitlab-ci-templates'
    ref: master
    file: '/license-listing.yml'
  - project: 'redmic-project/gitlab-ci-templates'
    ref: master
    file: '/packaging.yml'
  - project: 'redmic-project/gitlab-ci-templates'
    ref: master
    file: '/deployment-functional-unit.yml'

stages:
  - build-parent
  - build-lib
  - build-service
  - license-list
  - pre-package
  - package
  - post-package
  - deploy

variables:
  PROJECT_PARENT_NAME: time-series

maven-build-view:
  variables:
    GIT_SUBMODULE_STRATEGY: normal
  before_script:
    - mvn -f elasticsearch-cluster-runner compile
    - mvn -f elasticsearch-cluster-runner exec:java -Dexec.args="-numOfNode 1 -clusterName ${ELASTIC_CLUSTERNAME}" &

.docker-build:
  variables:
    COMPOSE_FILE_NAME: docker-compose.time-series.build.yml
    DBLD_PARENT_IMAGE_NAME: ${REDMIC_SERVER_IMAGE_NAME}
    DBLD_PARENT_IMAGE_TAG: ${REDMIC_SERVER_IMAGE_TAG}
